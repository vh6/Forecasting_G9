source("~/GitHub/Forecasting_G9/Project 1/project_1_victor.R", echo=TRUE)
View(df_nocovid)
fit <- df_nocovid |> model(ARIMA(value))
View(fit)
report(fit)
fc <- fit |> forecast(h = "14 months")
View(fc)
# Add 2 years to fc
typeof(fc)
fc$date <- fc$date + years(2)
ymd(fc$date)
typeof(fc$date)
typeof(fc$date[0])
fc$date[0]
fc$date <- fc$date + months(24)
ymd(paste0(fc$date, "-01"))
ymd(paste0(fc$date, "-01")) + years(2)
fc <- fit |> forecast(h = "15 months")
fc |> autoplot(df_nocovid) +
ggtitle("Forecast of monthly visitors to Vaud") +
ylab("Visitors") +
xlab("Months")
ymd(paste0(fc$date, "-01")) + years(2)
yearmonth(ymd(paste0(fc$date, "-01")) + years(2))
fc$date <- yearmonth(ymd(paste0(fc$date, "-01")) + years(2))
View(fc)
fc |> autoplot(df_nocovid) +
ggtitle("Forecast of monthly visitors to Vaud") +
ylab("Visitors") +
xlab("Months")
View(fc)
View(df)
View(fc)
# Create blank rows in original df
df <- df[order(df$date), ]
blank_rows <- data.frame(matrix(NA, nrow = 15, ncol = ncol(df)))
df <- rbind(df, blank_rows)
df <- bind_rows(df, blank_rows)
df <- as_tibble(df)
df <- rbind(df, blank_rows)
View(df)
blank_rows <- data.frame(matrix(NA, nrow = 15, ncol = ncol(df)))
df <- as_tibble(df)
df <- rbind(df, blank_rows)
colnames(blank_rows) <- colnames(df)
df <- as_tibble(df)
df <- rbind(df, blank_rows)
View(df)
# Add 2 years to fc
fc$date <- ymd(paste0(fc$date, "-01")) + years(2)
fit <- df_nocovid |> model(ARIMA(value))
report(fit)
fc <- fit |> forecast(h = "15 months")
# Add 2 years to fc
fc$date <- ymd(paste0(fc$date, "-01")) + years(2)
# Add dates and values from fc model to original df
df$date[(nrow(df) - 14):nrow(df)] <- fc$date
df$value[(nrow(df) - 14):nrow(df)] <- fc$.mean
# Plot final df
df |> autoplot(value) +
ggtitle("Monthly visitors to Vaud forecast") +
ylab("Visitors") +
xlab("Months")
# Plot final df
df <- tsibble(df, index = date)
df |> autoplot(value) +
ggtitle("Monthly visitors to Vaud forecast") +
ylab("Visitors") +
xlab("Months")
fc |> autoplot(df_nocovid) +
ggtitle("Forecast of monthly visitors to Vaud") +
ylab("Visitors") +
xlab("Months")
fc <- tsibble(fc, index = date)
fc |> autoplot(df_nocovid) +
ggtitle("Forecast of monthly visitors to Vaud") +
ylab("Visitors") +
xlab("Months")
df |> autoplot(value) +
ggtitle("Monthly visitors to Vaud forecast") +
ylab("Visitors") +
xlab("Months")
df |> autoplot(value) +
ggtitle("Forecast of monthly visitors to Vaud") +
ylab("Visitors") +
xlab("Months")
View(fc)
View(fc[[3]][[1]])
# Load data
df <- read.csv("Dataset_tourism.csv")
# Translate Monat column to english
german_months <- c("Januar", "Februar", "M\xe4rz", "April", "Mai", "Juni", "Juli", "August", "September", "Oktober", "November", "Dezember")
english_months <- month.name
# Replace German month names with English month names
df$Monat <- factor(df$Monat, levels = german_months, labels = english_months)
# Create date column
df$date <- ymd(paste(df$Jahr, df$Monat, "01", sep = "-"))
# Count NAs
sum(is.na(df$Jahr)) # 0 NAs
sum(is.na(df$Monat)) # 0 NAs
sum(is.na(df$date)) # 0 NAs
sum(is.na(df$value)) # 51395 NAs
sum(is.na(df$Kanton)) # 0 NAs
sum(is.na(df$Herkunftsland)) # 0 NAs
# Subset dataframe to remove nationalities and cantons, and keep totals.
df <- df[df$Herkunftsland == "Herkunftsland - Total" & df$Kanton == "Vaud", ]
# Transform df to tsibble
df <- tsibble(df, index = date)
# Plot visitors
df |> autoplot(value) +
ggtitle("Monthly visitors to Vaud") +
ylab("Visitors") +
xlab("Months")
# Add dummy variable covid, set to 1 between March 2020 and Feb 2022, 0 everywhere else.
df$covid <- ifelse(df$date >= ymd("2020-03-01") & df$date <= ymd("2022-02-01"), 1, 0)
# Create no covid tsibble
df_nocovid <- df
df_nocovid$value[df_nocovid$covid == 1] <- NA
df_nocovid |> autoplot(value) +
ggtitle("Monthly visitors to Vaud") +
ylab("Visitors") +
xlab("Months")
# Drop covid rows
df_nocovid <- df_nocovid[df_nocovid$covid != 1, ]
# Remove 2 years from data after covid
df_nocovid$date[df_nocovid$date >= ymd("2022-03-01")] <- df_nocovid$date[df_nocovid$date >= ymd("2022-03-01")] - years(2)
df_nocovid <- tsibble(df_nocovid, index = date)
df_nocovid |> autoplot(value) +
ggtitle("Monthly visitors to Vaud") +
ylab("Visitors") +
xlab("Months")
# Automatic ARIMA model
df_nocovid$date <- yearmonth(df_nocovid$date)
df_nocovid <- tsibble(df_nocovid, index = date)
fit <- df_nocovid |> model(ARIMA(value))
report(fit)
fc <- fit |> forecast(h = "15 months")
fc |> autoplot(df_nocovid) +
ggtitle("Forecast of monthly visitors to Vaud") +
ylab("Visitors") +
xlab("Months")
typeof(fc)
View(fc[[3]][[1]])
fc$lower[, "80%"]
fc |> autoplot(df_nocovid) +
ggtitle("Forecast of monthly visitors to Vaud") +
ylab("Visitors") +
xlab("Months")
View(fc)
fc$sd
fit
fit$sd
typeof(fit)
fc <- fit |> forecast(h = "15 months")
fc |> autoplot(df_nocovid) +
ggtitle("Forecast of monthly visitors to Vaud") +
ylab("Visitors") +
xlab("Months")
fc <- fit |> forecast(h = "15 months", level=90)
fc |> autoplot(df_nocovid) +
ggtitle("Forecast of monthly visitors to Vaud") +
ylab("Visitors") +
xlab("Months")
forecast(fit, h="15 months")
N(126531, 2e+07)
fc
fc$value
# Create confidence intervals from distributions in fc
distributions <- fc$value
confidence_levels <- c(0.80, 0.95)
# Function to calculate CI bounds
calculate_ci_bounds <- function(distribution, confidence_levels) {
lower_bounds <- sapply(confidence_levels, function(level) {
qnorm((1 - level) / 2, mean = distribution$mean, sd = distribution$sd)
})
upper_bounds <- sapply(confidence_levels, function(level) {
qnorm((1 + level) / 2, mean = distribution$mean, sd = distribution$sd)
})
return(list(lower_bounds = lower_bounds, upper_bounds = upper_bounds))
}
# Calculate confidence intervals
ci_bounds <- sapply(distributions, calculate_ci_bounds, confidence_levels)
typeof(fc$value)
typeof(fc$value[0])
typeof(fc$value[0][0])
# Load data
df <- read.csv("Dataset_tourism.csv")
# Translate Monat column to english
german_months <- c("Januar", "Februar", "M\xe4rz", "April", "Mai", "Juni", "Juli", "August", "September", "Oktober", "November", "Dezember")
english_months <- month.name
# Replace German month names with English month names
df$Monat <- factor(df$Monat, levels = german_months, labels = english_months)
# Create date column
df$date <- ymd(paste(df$Jahr, df$Monat, "01", sep = "-"))
# Count NAs
sum(is.na(df$Jahr)) # 0 NAs
sum(is.na(df$Monat)) # 0 NAs
sum(is.na(df$date)) # 0 NAs
sum(is.na(df$value)) # 51395 NAs
sum(is.na(df$Kanton)) # 0 NAs
sum(is.na(df$Herkunftsland)) # 0 NAs
# Subset dataframe to remove nationalities and cantons, and keep totals.
df <- df[df$Herkunftsland == "Herkunftsland - Total" & df$Kanton == "Vaud", ]
# Transform df to tsibble
df <- tsibble(df, index = date)
# Plot visitors
df |> autoplot(value) +
ggtitle("Monthly visitors to Vaud") +
ylab("Visitors") +
xlab("Months")
# Add dummy variable covid, set to 1 between March 2020 and Feb 2022, 0 everywhere else.
df$covid <- ifelse(df$date >= ymd("2020-03-01") & df$date <= ymd("2022-02-01"), 1, 0)
# Create no covid tsibble
df_nocovid <- df
df_nocovid$value[df_nocovid$covid == 1] <- NA
df_nocovid |> autoplot(value) +
ggtitle("Monthly visitors to Vaud") +
ylab("Visitors") +
xlab("Months")
# Drop covid rows
df_nocovid <- df_nocovid[df_nocovid$covid != 1, ]
# Remove 2 years from data after covid
df_nocovid$date[df_nocovid$date >= ymd("2022-03-01")] <- df_nocovid$date[df_nocovid$date >= ymd("2022-03-01")] - years(2)
df_nocovid <- tsibble(df_nocovid, index = date)
df_nocovid |> autoplot(value) +
ggtitle("Monthly visitors to Vaud") +
ylab("Visitors") +
xlab("Months")
# Automatic ARIMA model
df_nocovid$date <- yearmonth(df_nocovid$date)
df_nocovid <- tsibble(df_nocovid, index = date)
fit <- df_nocovid |> model(ARIMA(value))
report(fit)
fc <- fit |> forecast(h = "15 months", level=90)
fc |> autoplot(df_nocovid) +
ggtitle("Forecast of monthly visitors to Vaud") +
ylab("Visitors") +
xlab("Months")
# Add 2 years to fc
fc$date <- ymd(paste0(fc$date, "-01")) + years(2)
# Create blank rows in original df
df <- df[order(df$date), ]
blank_rows <- data.frame(matrix(NA, nrow = 15, ncol = ncol(df)))
colnames(blank_rows) <- colnames(df)
df <- as_tibble(df)
df <- rbind(df, blank_rows)
# Add dates and values from fc model to original df
df$date[(nrow(df) - 14):nrow(df)] <- fc$date
df$value[(nrow(df) - 14):nrow(df)] <- fc$.mean
# Add confidence interval column to original df
df <- df %>%
mutate(ci = NA)
View(df)
df$ci[(nrow(df) - 14):nrow(df)] <- fc$value
# Plot final df
df <- tsibble(df, index = date)
df |> autoplot(value) +
ggtitle("Forecast of monthly visitors to Vaud") +
ylab("Visitors") +
xlab("Months")
df$ci[-1]
df$ci[240]
df$ci[240]$mu
tail(df$ci, 1)
tail(df$ci, 1)$sigma
tail(df$ci, 1)[0]
tail(df$ci, 1)[0][0]
